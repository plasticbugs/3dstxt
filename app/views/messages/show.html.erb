<% if flash[:notice] %>
<div class="notice"><%= flash[:notice] %></div>
<% end %>


<% if @comment && @comment.errors.any? %>
	<div class="errors">
	<ul>
    <% @comment.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
</div>
<% end %>

<% if flash[:errors] %>
<div class="errors">
	<ul>
<% flash[:errors].each do |error| %>
<li><%= error %></li>
<% end %>
</ul>
</div>
<% end %>

<div class="content">
	
	<div class="message">
	<%= simple_format(@message.contents.gsub(/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/) { |match|
"<a href='#{match}'>#{match}</a>"
}) %>
	<% if @friendcode && @friendcode.length == 15 && @message.display_fc? %>
		<h1>
		<%= "My Friend Code: #{@friendcode}" %> 
		</h1>
	<% end %>
	</div>

<div class="share">Share this link as a 3DS message:<br/>
<%= link_to "3dstxt.com/#{@message.pickUpCode}" %><br/>
</div>
<div class="comment_entry"><p>Add your comment</p>
<%= form_for ([@message, @message.comments.build]) do |f| %>

<%= f.label "Your Name:" %><br />
<%= f.text_field :author, :placeholder => "Enter your name here" %><br/>
<%= f.label "Your email address (this will not be shared):" %><br/>
<%= f.text_field :author_email, :placeholder => "Enter your email here" %>
<%= f.text_area :content, :class => "comment_input", :placeholder => "Enter a comment here." %>

<%= f.submit "Post comment", :class => "comment_submit" %>
<% end %>
</div>
<div class="comment_box">
	<h1>Comments:</h1>
	<% @comments.each do |comment| %>
	<% if current_user && current_user.id == comment.message.user_id %>
		
			<div class="comment"><div class="comment_info"><span class="comment_author"><%= comment.author %></span> <%= comment.created_at.strftime("posted on %B %d @ %I:%M%p") %><%= link_to "Delete Comment", [comment.message, comment], :confirm => "Are you sure you want to delete this comment? It will be gone forever.", :method => :delete, :alt => 'Delete Comment', :class => 'delete'%></div>
			<%=  nl2br(comment.content.html_safe) %>
			</div>

	<% else %>
	<div class="comment"><div class="comment_info"><span class="comment_author"><%= comment.author %></span> <%= comment.created_at.strftime("posted on %B %d @ %I:%M%p") %></div>
			<%= nl2br(comment.content.html_safe) %>
			</div>


	<% end %>
	<% end %>
</div>


<div class="make_your_own"><%= link_to "Make your own 3DS TXT!", new_message_path %></div>

</div>